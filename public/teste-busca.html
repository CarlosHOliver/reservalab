<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Busca Global - ReservaLAB</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Teste da Busca Global</h1>
        
        <div class="mt-4">
            <button class="btn btn-primary" onclick="testarBusca()">
                <i class="bi bi-search"></i> Teste de Busca
            </button>
            
            <button class="btn btn-success ms-2" onclick="abrirBuscaReserva()">
                <i class="bi bi-search"></i> Abrir Modal de Busca
            </button>
        </div>
        
        <div class="mt-4">
            <h3>Status dos Módulos:</h3>
            <ul id="statusModulos" class="list-group">
                <!-- Será preenchido pelo JavaScript -->
            </ul>
        </div>
        
        <div class="mt-4">
            <h3>Console de Depuração:</h3>
            <div id="debugConsole" class="border p-3 bg-light" style="height: 300px; overflow-y: auto;">
                <!-- Logs serão exibidos aqui -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/busca.js"></script>
    
    <script>
        // Interceptar console.log para mostrar no debug
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToDebugConsole(message, type = 'info') {
            const debugDiv = document.getElementById('debugConsole');
            if (debugDiv) {
                const timestamp = new Date().toLocaleTimeString();
                const className = type === 'error' ? 'text-danger' : type === 'warn' ? 'text-warning' : 'text-info';
                debugDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToDebugConsole(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToDebugConsole(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToDebugConsole(args.join(' '), 'warn');
        };
        
        function verificarStatus() {
            const statusList = document.getElementById('statusModulos');
            const modulos = {
                'Bootstrap': typeof bootstrap !== 'undefined',
                'Supabase': typeof supabase !== 'undefined',
                'API': typeof API !== 'undefined',
                'Utils': typeof Utils !== 'undefined',
                'abrirBuscaReserva': typeof window.abrirBuscaReserva === 'function',
                'buscarReserva': typeof window.buscarReserva === 'function'
            };
            
            statusList.innerHTML = '';
            for (const [nome, disponivel] of Object.entries(modulos)) {
                const li = document.createElement('li');
                li.className = `list-group-item d-flex justify-content-between align-items-center`;
                li.innerHTML = `
                    ${nome}
                    <span class="badge ${disponivel ? 'bg-success' : 'bg-danger'}">
                        ${disponivel ? 'OK' : 'ERRO'}
                    </span>
                `;
                statusList.appendChild(li);
            }
        }
        
        function testarBusca() {
            console.log('=== TESTE DE BUSCA INICIADO ===');
            console.log('Função abrirBuscaReserva disponível:', typeof window.abrirBuscaReserva);
            console.log('Função buscarReserva disponível:', typeof window.buscarReserva);
            
            if (typeof window.abrirBuscaReserva === 'function') {
                try {
                    window.abrirBuscaReserva();
                    console.log('✅ Modal de busca aberto com sucesso');
                } catch (error) {
                    console.error('❌ Erro ao abrir modal:', error);
                }
            } else {
                console.error('❌ Função abrirBuscaReserva não está disponível');
            }
        }
        
        // Verificar status quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                verificarStatus();
                console.log('Página de teste carregada');
            }, 1000);
        });
    </script>
</body>
</html>
