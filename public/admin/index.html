<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrativa - ReservaLAB FAEN/UFGD</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- CSS Customizado -->
    <link href="../assets/css/style.css" rel="stylesheet">
    <style>
        .col-md-2 {
            flex: 0 0 auto;
            width: 16.66667%;
        }
        @media (max-width: 992px) {
            .col-md-2 {
                width: 33.33333%;
                margin-bottom: 1rem;
            }
        }
        @media (max-width: 768px) {
            .col-md-2 {
                width: 50%;
                margin-bottom: 1rem;
            }
        }
        @media (max-width: 576px) {
            .col-md-2 {
                width: 100%;
            }
        }
    </style>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
</head>
<body>
    <!-- Header -->
    <header class="bg-primary text-white py-3 shadow-sm">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <img src="../assets/images/logo-ufgd.png" alt="UFGD" class="me-3" style="height: 50px;">
                        <div>
                            <h1 class="h4 mb-0">ReservaLAB</h1>
                            <small class="opacity-75">Dashboard Administrativa - FAEN/UFGD</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end" id="userInfo" style="display: none;">
                    <span class="me-3">Bem-vindo, <strong id="userName"></strong></span>
                    <button class="btn btn-outline-light btn-sm" onclick="logout()">
                        <i class="bi bi-box-arrow-right"></i> Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Tela de Login -->
    <div id="loginScreen" class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0"><i class="bi bi-shield-lock"></i> Acesso Administrativo</h3>
                    </div>
                    <div class="card-body p-4">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="loginUser" class="form-label">Login:</label>
                                <input type="text" class="form-control" id="loginUser" required>
                            </div>
                            <div class="mb-3">
                                <label for="loginPassword" class="form-label">Senha:</label>
                                <input type="password" class="form-control" id="loginPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="bi bi-box-arrow-in-right"></i> Entrar
                            </button>
                        </form>
                        <div id="loginError" class="alert alert-danger mt-3" style="display: none;"></div>
                        <div class="mt-3 text-center">
                            <small class="text-muted">
                                Para ter acesso, solicite suas credenciais ao administrador do sistema.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="dashboardScreen" style="display: none;">
        <!-- Navegação -->
        <nav class="bg-light py-2 border-bottom">
            <div class="container">
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reservas')">
                            <i class="bi bi-calendar-check"></i> Reservas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('laboratorios')">
                            <i class="bi bi-building"></i> Laboratórios
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('equipamentos')">
                            <i class="bi bi-tools"></i> Equipamentos
                        </a>
                    </li>
                    <li class="nav-item" id="navUsuarios">
                        <a class="nav-link" href="#" onclick="showSection('usuarios')">
                            <i class="bi bi-people"></i> Usuários
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="bi bi-exclamation-triangle"></i> Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('formularios')">
                            <i class="bi bi-file-text"></i> Formulários
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('configuracoes')">
                            <i class="bi bi-gear"></i> Configurações
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Seção Dashboard -->
            <div id="section-dashboard" class="dashboard-section">
                <div class="row mb-4">
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-clock-history text-warning" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalPendentes">0</h4>
                                <p class="text-muted">Reservas Pendentes</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalAprovadas">0</h4>
                                <p class="text-muted">Reservas Aprovadas</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-building text-primary" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalLaboratorios">0</h4>
                                <p class="text-muted">Laboratórios</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-tools text-info" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalEquipamentos">0</h4>
                                <p class="text-muted">Equipamentos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-people text-secondary" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalUsuarios">0</h4>
                                <p class="text-muted">Usuários Ativos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalReportsPendentesDb">0</h4>
                                <p class="text-muted">Reports Pendentes</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Reservas Pendentes</h5>
                            </div>
                            <div class="card-body">
                                <div id="reservasPendentes">
                                    <p class="text-muted text-center">Carregando...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="bi bi-graph-up"></i> Estatísticas do Mês</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Total de Reservas:</span>
                                    <strong id="estatTotalMes">0</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Taxa de Aprovação:</span>
                                    <strong id="estatTaxaAprovacao">0%</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Laboratório Mais Usado:</span>
                                    <strong id="estatLabMaisUsado">-</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Equipamento Mais Usado:</span>
                                    <strong id="estatEquipMaisUsado">-</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Reservas -->
            <div id="section-reservas" class="dashboard-section" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Gerenciar Reservas</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3 align-items-end">
                            <div class="col-md-3">
                                <select class="form-control" id="filtroStatus">
                                    <option value="">Todos os Status</option>
                                    <option value="pendente">Pendentes</option>
                                    <option value="aprovada">Aprovadas</option>
                                    <option value="rejeitada">Rejeitadas</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="filtroData">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary" onclick="filtrarReservas()">
                                    <i class="bi bi-search"></i> Filtrar
                                </button>
                                <button class="btn btn-secondary" onclick="exportarReservas()">
                                    <i class="bi bi-download"></i> Exportar
                                </button>
                            </div>
                            <div class="col-md-3 text-end">
                                <button class="btn btn-success" onclick="novaReservaAdmin()" title="Criar nova reserva pré-aprovada (apenas gestores/administradores)">
                                    <i class="bi bi-plus-circle"></i> Nova Reserva
                                    <span class="badge bg-light text-success ms-1">Pré-aprovada</span>
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Protocolo</th>
                                        <th>Solicitante</th>
                                        <th>Data/Hora</th>
                                        <th>Recurso</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaReservas">
                                    <tr>
                                        <td colspan="6" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Laboratórios -->
            <div id="section-laboratorios" class="dashboard-section" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-building"></i> Gerenciar Laboratórios</h5>
                        <button class="btn btn-light" onclick="novoLaboratorio()">
                            <i class="bi bi-plus"></i> Novo Laboratório
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Bloco</th>
                                        <th>Capacidade</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaLaboratorios">
                                    <tr>
                                        <td colspan="5" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Equipamentos -->
            <div id="section-equipamentos" class="dashboard-section" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-tools"></i> Gerenciar Equipamentos</h5>
                        <button class="btn btn-light" onclick="novoEquipamento()">
                            <i class="bi bi-plus"></i> Novo Equipamento
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Patrimônio</th>
                                        <th>Bloco</th>
                                        <th>Local</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaEquipamentos">
                                    <tr>
                                        <td colspan="6" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Reports -->
            <div id="section-reports" class="dashboard-section" style="display: none;">
                <!-- Estatísticas de Reports -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center bg-warning text-dark">
                            <div class="card-body">
                                <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalReportsPendentes">0</h4>
                                <p class="mb-0">Pendentes</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center bg-info text-white">
                            <div class="card-body">
                                <i class="bi bi-clipboard-check" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalReportsResolvidos">0</h4>
                                <p class="mb-0">Resolvidos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center bg-primary text-white">
                            <div class="card-body">
                                <i class="bi bi-clipboard-data" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="totalReports">0</h4>
                                <p class="mb-0">Total</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center bg-secondary text-white">
                            <div class="card-body">
                                <i class="bi bi-calendar-week" style="font-size: 2rem;"></i>
                                <h4 class="mt-2" id="reportsUltimos7Dias">0</h4>
                                <p class="mb-0">Últimos 7 dias</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros e Controles -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Gerenciar Reports/Ocorrências</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="filtroStatusReport" class="form-label">Status:</label>
                                <select class="form-control" id="filtroStatusReport">
                                    <option value="">Todos os Status</option>
                                    <option value="aberto">Aberto</option>
                                    <option value="em_analise">Em Análise</option>
                                    <option value="resolvido">Resolvido</option>
                                    <option value="arquivado">Arquivado</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filtroTipoReport" class="form-label">Tipo:</label>
                                <select class="form-control" id="filtroTipoReport">
                                    <option value="">Todos os Tipos</option>
                                    <option value="nao_compareceu">Não compareceu</option>
                                    <option value="problema_acesso">Problema de acesso</option>
                                    <option value="equipamento_danificado">Equipamento danificado</option>
                                    <option value="uso_inadequado">Uso inadequado</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filtroCienteReport" class="form-label">Ciência:</label>
                                <select class="form-control" id="filtroCienteReport">
                                    <option value="">Todos</option>
                                    <option value="false">Sem ciência</option>
                                    <option value="true">Com ciência</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" onclick="filtrarReports()">
                                        <i class="bi bi-search"></i> Filtrar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabela de Reports -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Data/Hora</th>
                                        <th>Tipo</th>
                                        <th>Protocolo</th>
                                        <th>Descrição</th>
                                        <th>Status</th>
                                        <th>Ciência</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaReports">
                                    <tr>
                                        <td colspan="8" class="text-center">Carregando reports...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Usuários -->
            <div id="section-usuarios" class="dashboard-section" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-people"></i> Gerenciar Usuários</h5>
                        <button class="btn btn-light" onclick="novoUsuario()">
                            <i class="bi bi-plus"></i> Novo Usuário
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Login</th>
                                        <th>E-mail</th>
                                        <th>Perfil</th>
                                        <th>Bloco</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaUsuarios">
                                    <tr>
                                        <td colspan="7" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Formulários -->
            <div id="section-formularios" class="dashboard-section" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-file-text"></i> Formulários de Acesso</h5>
                        <button class="btn btn-light" onclick="novoFormulario()">
                            <i class="bi bi-plus"></i> Novo Formulário
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Título</th>
                                        <th>URL</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaFormularios">
                                    <tr>
                                        <td colspan="4" class="text-center">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Configurações -->
            <div id="section-configuracoes" class="dashboard-section" style="display: none;">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="bi bi-gear"></i> Configurações Gerais</h5>
                            </div>
                            <div class="card-body">
                                <form id="formConfiguracoes">
                                    <div class="mb-3">
                                        <label for="horarioInicio" class="form-label">Horário de Expediente - Início:</label>
                                        <input type="time" class="form-control" id="horarioInicio">
                                    </div>
                                    <div class="mb-3">
                                        <label for="horarioFim" class="form-label">Horário de Expediente - Fim:</label>
                                        <input type="time" class="form-control" id="horarioFim">
                                    </div>
                                    <div class="mb-3">
                                        <label for="diasExpediente" class="form-label">Dias de Expediente:</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="1" id="seg">
                                            <label class="form-check-label" for="seg">Segunda-feira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="2" id="ter">
                                            <label class="form-check-label" for="ter">Terça-feira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="3" id="qua">
                                            <label class="form-check-label" for="qua">Quarta-feira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="4" id="qui">
                                            <label class="form-check-label" for="qui">Quinta-feira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="5" id="sex">
                                            <label class="form-check-label" for="sex">Sexta-feira</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="6" id="sab">
                                            <label class="form-check-label" for="sab">Sábado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="7" id="dom">
                                            <label class="form-check-label" for="dom">Domingo</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check"></i> Salvar Configurações
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="bi bi-shield-lock"></i> Alterar Senha</h5>
                            </div>
                            <div class="card-body">
                                <form id="formAlterarSenha">
                                    <div class="mb-3">
                                        <label for="senhaAtual" class="form-label">Senha Atual:</label>
                                        <input type="password" class="form-control" id="senhaAtual" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="novaSenha" class="form-label">Nova Senha:</label>
                                        <input type="password" class="form-control" id="novaSenha" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmarSenha" class="form-label">Confirmar Nova Senha:</label>
                                        <input type="password" class="form-control" id="confirmarSenha" required>
                                    </div>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="bi bi-key"></i> Alterar Senha
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Reserva Admin -->
    <div class="modal fade" id="modalNovaReservaAdmin" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-plus-circle"></i> Nova Reserva (Pré-aprovada)
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formNovaReservaAdmin">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="bi bi-person"></i> Dados do Solicitante</h6>
                                <div class="mb-3">
                                    <label for="nomeCompleto" class="form-label">Nome Completo *</label>
                                    <input type="text" class="form-control" id="nomeCompleto" required>
                                </div>
                                <div class="mb-3">
                                    <label for="siapeRga" class="form-label">SIAPE/RGA *</label>
                                    <input type="text" class="form-control" id="siapeRga" required>
                                </div>
                                <div class="mb-3">
                                    <label for="email" class="form-label">E-mail *</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="telefone" class="form-label">Telefone</label>
                                    <input type="tel" class="form-control" id="telefone">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="bi bi-calendar"></i> Dados da Reserva</h6>
                                <div class="mb-3">
                                    <label for="dataReserva" class="form-label">Data da Reserva *</label>
                                    <input type="date" class="form-control" id="dataReserva" required>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="horaInicio" class="form-label">Hora Início *</label>
                                            <input type="time" class="form-control" id="horaInicio" required>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="horaFim" class="form-label">Hora Fim *</label>
                                            <input type="time" class="form-control" id="horaFim" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="laboratorioSelect" class="form-label">Laboratório</label>
                                    <select class="form-control" id="laboratorioSelect">
                                        <option value="">Selecione um laboratório</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="equipamentosSelect" class="form-label">Equipamentos</label>
                                    <select class="form-control" id="equipamentosSelect" multiple>
                                        <!-- Carregado dinamicamente -->
                                    </select>
                                    <div class="form-text">Mantenha Ctrl pressionado para selecionar múltiplos equipamentos</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="finalidade" class="form-label">Finalidade da Reserva *</label>
                                    <textarea class="form-control" id="finalidade" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="professorAcompanhante" class="form-label">Professor/Técnico Responsável</label>
                                    <input type="text" class="form-control" id="professorAcompanhante">
                                </div>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> <strong>Atenção:</strong> Esta reserva será criada com status <strong>APROVADA</strong> automaticamente.
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="salvarNovaReservaAdmin()">
                        <i class="bi bi-check-circle"></i> Criar Reserva Aprovada
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes do Report -->
    <div class="modal fade" id="modalDetalhesReport" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle"></i> Detalhes do Report
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detalhesReportContent">
                    <!-- Conteúdo será preenchido dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-success" id="btnMarcarCiente" onclick="mostrarModalCiencia()" style="display: none;">
                        <i class="bi bi-check"></i> Marcar Ciência
                    </button>
                    <button type="button" class="btn btn-primary" id="btnAlterarStatus" onclick="mostrarModalStatus()" style="display: none;">
                        <i class="bi bi-pencil"></i> Alterar Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Marcar Ciência -->
    <div class="modal fade" id="modalCiencia" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-check-circle"></i> Marcar Ciência
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Confirmação:</strong> Você está marcando ciência deste report. Esta ação registrará seu nome e horário.
                    </div>
                    <div class="mb-3">
                        <label for="observacoesCiencia" class="form-label">Observações (opcional):</label>
                        <textarea class="form-control" id="observacoesCiencia" rows="3" 
                                  placeholder="Adicione observações sobre as providências tomadas..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="confirmarCiencia()">
                        <i class="bi bi-check"></i> Confirmar Ciência
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Alterar Status -->
    <div class="modal fade" id="modalStatus" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-pencil"></i> Alterar Status
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="novoStatus" class="form-label">Novo Status:</label>
                        <select class="form-control" id="novoStatus" required>
                            <option value="">Selecione o novo status</option>
                            <option value="aberto">Aberto</option>
                            <option value="em_analise">Em Análise</option>
                            <option value="resolvido">Resolvido</option>
                            <option value="arquivado">Arquivado</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="observacoesStatus" class="form-label">Observações:</label>
                        <textarea class="form-control" id="observacoesStatus" rows="3" 
                                  placeholder="Descreva as ações tomadas ou motivo da alteração..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="confirmarAlteracaoStatus()">
                        <i class="bi bi-check"></i> Alterar Status
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalhes da Reserva -->
    <div class="modal fade" id="modalDetalhesReserva" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Detalhes da Reserva</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detalhesReservaContent">
                    <!-- Conteúdo será preenchido dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-success" id="btnAprovar" onclick="aprovarReserva()" style="display: none;">
                        <i class="bi bi-check"></i> Aprovar
                    </button>
                    <button type="button" class="btn btn-danger" id="btnRejeitar" onclick="mostrarMotivoRejeicao()" style="display: none;">
                        <i class="bi bi-x"></i> Rejeitar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Motivo Rejeição -->
    <div class="modal fade" id="modalMotivoRejeicao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Motivo da Rejeição</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="motivoRejeicao" class="form-label">Informe o motivo da rejeição:</label>
                        <textarea class="form-control" id="motivoRejeicao" rows="4" required placeholder="Descreva o motivo da rejeição da reserva..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" onclick="rejeitarReserva()">
                        <i class="bi bi-x"></i> Confirmar Rejeição
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Laboratório -->
    <div class="modal fade" id="modalLaboratorio" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalLaboratorioTitle">
                        <i class="bi bi-building"></i> Novo Laboratório
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formLaboratorio">
                        <input type="hidden" id="laboratorioId">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="laboratorioNome" class="form-label">Nome do Laboratório *</label>
                                    <input type="text" class="form-control" id="laboratorioNome" required 
                                           placeholder="Ex: Laboratório de Química">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="laboratorioBloco" class="form-label">Bloco *</label>
                                    <select class="form-control" id="laboratorioBloco" required>
                                        <option value="">Selecione o bloco</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="laboratorioCapacidade" class="form-label">Capacidade</label>
                                    <input type="number" class="form-control" id="laboratorioCapacidade" 
                                           min="1" value="1" placeholder="Número de pessoas">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="laboratorioFoto" class="form-label">URL da Foto</label>
                                    <input type="url" class="form-control" id="laboratorioFoto" 
                                           placeholder="https://exemplo.com/foto.jpg">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="laboratorioDescricao" class="form-label">Descrição</label>
                            <textarea class="form-control" id="laboratorioDescricao" rows="3" 
                                      placeholder="Descrição do laboratório, equipamentos disponíveis, etc."></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="laboratorioCompartilhado" 
                                               onchange="document.getElementById('divMaxOcupantes').style.display = this.checked ? 'block' : 'none'">
                                        <label class="form-check-label" for="laboratorioCompartilhado">
                                            Permitir uso compartilhado
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="laboratorioAcompanhamento">
                                        <label class="form-check-label" for="laboratorioAcompanhamento">
                                            Necessita acompanhamento
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="divMaxOcupantes" style="display: none;">
                            <label for="laboratorioMaxOcupantes" class="form-label">Máximo de ocupantes simultâneos</label>
                            <input type="number" class="form-control" id="laboratorioMaxOcupantes" 
                                   min="1" value="1">
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="laboratorioAtivo" checked>
                                <label class="form-check-label" for="laboratorioAtivo">
                                    Laboratório ativo
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarLaboratorio()">
                        <i class="bi bi-check"></i> Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirmação Exclusão -->
    <div class="modal fade" id="modalConfirmacaoExclusao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle"></i> Confirmar Exclusão
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="textoConfirmacaoExclusao">Tem certeza que deseja excluir este item?</p>
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Atenção:</strong> Esta ação não pode ser desfeita.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="btnConfirmarExclusao">
                        <i class="bi bi-trash"></i> Confirmar Exclusão
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Equipamento -->
    <div class="modal fade" id="modalEquipamento" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="modalEquipamentoTitle">
                        <i class="bi bi-tools"></i> Novo Equipamento
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEquipamento">
                        <input type="hidden" id="equipamentoId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoNome" class="form-label">Nome do Equipamento *</label>
                                    <input type="text" class="form-control" id="equipamentoNome" required 
                                           placeholder="Ex: Microscópio Digital">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoPatrimonio" class="form-label">Número do Patrimônio *</label>
                                    <input type="text" class="form-control" id="equipamentoPatrimonio" required 
                                           placeholder="Ex: EQUIP001">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoBloco" class="form-label">Bloco *</label>
                                    <select class="form-control" id="equipamentoBloco" required>
                                        <option value="">Selecione o bloco</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoLocal" class="form-label">Local *</label>
                                    <input type="text" class="form-control" id="equipamentoLocal" required 
                                           placeholder="Ex: Sala 101, Lab. Química">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="equipamentoDescricao" class="form-label">Descrição</label>
                            <textarea class="form-control" id="equipamentoDescricao" rows="3" 
                                      placeholder="Descrição do equipamento, especificações técnicas, etc."></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoStatus" class="form-label">Status</label>
                                    <select class="form-control" id="equipamentoStatus">
                                        <option value="disponivel">Disponível</option>
                                        <option value="em_manutencao">Em Manutenção</option>
                                        <option value="inativo">Inativo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="equipamentoFoto" class="form-label">URL da Foto</label>
                                    <input type="url" class="form-control" id="equipamentoFoto" 
                                           placeholder="https://exemplo.com/foto.jpg">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="equipamentoCompartilhado" 
                                               onchange="document.getElementById('divMaxOcupantesEquip').style.display = this.checked ? 'block' : 'none'">
                                        <label class="form-check-label" for="equipamentoCompartilhado">
                                            Permitir uso compartilhado
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="equipamentoAcompanhamento">
                                        <label class="form-check-label" for="equipamentoAcompanhamento">
                                            Necessita acompanhamento
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="divMaxOcupantesEquip" style="display: none;">
                            <label for="equipamentoMaxOcupantes" class="form-label">Máximo de ocupantes simultâneos</label>
                            <input type="number" class="form-control" id="equipamentoMaxOcupantes" 
                                   min="1" value="1">
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="equipamentoAtivo" checked>
                                <label class="form-check-label" for="equipamentoAtivo">
                                    Equipamento ativo no sistema
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-info" onclick="salvarEquipamento()">
                        <i class="bi bi-check"></i> Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-5">
        <div class="container">
            <p class="text-muted mb-0">
                Desenvolvido por Carlos Henrique C. de Oliveira - Laboratórios de Informática - FAEN/UFGD 2025
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    
    <!-- Luxon para manipulação de datas com timezone -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    
    <!-- BCrypt para verificação de hash de senhas - Múltiplas opções de fallback -->
    <script>
        // Tentar carregar bcrypt de múltiplas fontes
        const loadBcrypt = () => {
            const scripts = [
                'https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js',
                'https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js',
                'https://unpkg.com/bcryptjs@2.4.3/dist/bcrypt.min.js'
            ];
            
            let index = 0;
            
            function tryLoad() {
                if (index >= scripts.length) {
                    console.error('❌ ERRO: Não foi possível carregar bcrypt de nenhuma fonte');
                    alert('Erro: Biblioteca bcrypt não pode ser carregada. Verifique sua conexão.');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = scripts[index];
                script.onload = () => {
                    console.log('✅ bcrypt carregado com sucesso de:', scripts[index]);
                };
                script.onerror = () => {
                    console.warn('⚠️ Falha ao carregar bcrypt de:', scripts[index]);
                    index++;
                    tryLoad();
                };
                document.head.appendChild(script);
            }
            
            tryLoad();
        };
        
        loadBcrypt();
    </script>
    
    <script>
        // Verificar se as bibliotecas foram carregadas após um delay
        setTimeout(() => {
            if (typeof window.supabase === 'undefined') {
                console.error('❌ ERRO: Biblioteca Supabase não carregada');
                alert('Erro: Biblioteca Supabase não foi carregada. Verifique sua conexão.');
            } else {
                console.log('✅ Supabase carregado');
            }
            
            if (typeof bcrypt === 'undefined' && typeof dcodeIO === 'undefined' && typeof window.bcrypt === 'undefined') {
                console.error('❌ ERRO: Biblioteca bcrypt não carregada');
                alert('Erro: Biblioteca bcrypt não foi carregada. Tente recarregar a página.');
            } else {
                console.log('✅ bcrypt carregado');
            }
        }, 2000);
    </script>
    
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/admin.js"></script>
</body>
</html>
