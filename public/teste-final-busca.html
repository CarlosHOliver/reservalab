<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Busca Global</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>üîç Teste Final - Busca Global</h2>
        
        <div class="alert alert-info">
            <strong>Teste das corre√ß√µes aplicadas:</strong><br>
            Este teste verifica se as fun√ß√µes est√£o sendo exportadas corretamente e est√£o dispon√≠veis para onclick.
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5>‚úÖ Teste de Onclick</h5>
                    </div>
                    <div class="card-body">
                        <p>Simula o mesmo onclick do patrimonial.html:</p>
                        <button class="btn btn-primary" onclick="abrirBuscaReserva()">
                            <i class="bi bi-search"></i> Abrir Busca (onclick)
                        </button>
                        
                        <button class="btn btn-secondary ms-2" onclick="testarFuncao()">
                            <i class="bi bi-code"></i> Teste Program√°tico
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5>üìä Status das Fun√ß√µes</h5>
                    </div>
                    <div class="card-body">
                        <div id="statusFuncoes">
                            <p>Carregando...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-3">
            <div class="card">
                <div class="card-header">
                    <h5>üìù Log de Eventos</h5>
                </div>
                <div class="card-body">
                    <div id="logEventos" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; font-family: monospace; font-size: 12px;">
                        <!-- Logs aparecer√£o aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/busca.js"></script>
    
    <script>
        let logCounter = 0;
        
        function addLog(message, type = 'info') {
            logCounter++;
            const logDiv = document.getElementById('logEventos');
            if (logDiv) {
                const timestamp = new Date().toLocaleTimeString();
                const color = type === 'error' ? '#dc3545' : type === 'success' ? '#198754' : '#0d6efd';
                logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }
        
        // Interceptar console.log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };
        
        function verificarStatus() {
            const statusDiv = document.getElementById('statusFuncoes');
            
            const funcoes = {
                'abrirBuscaReserva': typeof window.abrirBuscaReserva,
                'buscarReserva': typeof window.buscarReserva,
                'mostrarResultadoBusca': typeof window.mostrarResultadoBusca
            };
            
            let html = '<ul class="list-group list-group-flush">';
            for (const [nome, tipo] of Object.entries(funcoes)) {
                const disponivel = tipo === 'function';
                const classe = disponivel ? 'text-success' : 'text-danger';
                const icone = disponivel ? 'check-circle-fill' : 'x-circle-fill';
                html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                    ${nome}
                    <span class="${classe}">
                        <i class="bi bi-${icone}"></i> ${tipo}
                    </span>
                </li>`;
            }
            html += '</ul>';
            
            statusDiv.innerHTML = html;
            
            // Log detalhado
            addLog('=== VERIFICA√á√ÉO DE STATUS ===');
            for (const [nome, tipo] of Object.entries(funcoes)) {
                addLog(`${nome}: ${tipo} ${tipo === 'function' ? '‚úÖ' : '‚ùå'}`);
            }
        }
        
        function testarFuncao() {
            addLog('=== TESTE PROGRAM√ÅTICO ===');
            
            if (typeof window.abrirBuscaReserva === 'function') {
                try {
                    window.abrirBuscaReserva();
                    addLog('‚úÖ abrirBuscaReserva executada com sucesso', 'success');
                } catch (error) {
                    addLog('‚ùå Erro ao executar abrirBuscaReserva: ' + error.message, 'error');
                }
            } else {
                addLog('‚ùå abrirBuscaReserva n√£o √© uma fun√ß√£o', 'error');
            }
        }
        
        // Verificar status automaticamente
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üìÑ DOM carregado');
            
            // Aguardar um pouco para que os scripts carreguem
            setTimeout(() => {
                verificarStatus();
                addLog('üîç Verifica√ß√£o inicial conclu√≠da');
            }, 1000);
        });
        
        // Log inicial
        addLog('üöÄ P√°gina de teste carregada');
    </script>
</body>
</html>
